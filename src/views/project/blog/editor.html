<!doctype html>
<html lang="{{head.lang.short}}">
  <head>
    {{> layout/head}}
    <link rel="stylesheet" href="/css/components/sidebar.css" />
    <link rel="stylesheet" href="/css/components/userbar.css" />
    <!-- expose filename for external script -->
    <script>
      window.__FILENAME__ = "{{filename}}";
    </script>
  </head>
  <body class="page post-page" data-project-id="{{projectId}}">
    <!-- top loading spinner -->
    <div data-startup-spinner class="loading-bar" style="display: none"></div>

    {{> sidebar}} {{> userbar show_user_menu=true}}
    <main class="page__wrap">
      <header class="page__header">
        <div class="title__wrap">
          <h1 id="page-title" class="title__name">{{title}}</h1>
          <div id="page-desc" class="title__desc">
            Editing {{#contentDir}}{{contentDir}}/{{/contentDir}}{{filename}}
          </div>
        </div>
        <div class="actions">
          <a class="chip" href="/p/{{projectId}}" title="Back to project"
            >Back</a
          >
          <!-- <a
            id="preview-btn"
            class="chip chip--ghost"
            href="#"
            target="_blank"
            rel="noopener"
            >Preview</a
          > -->
          <button id="save-draft-btn" class="chip" type="button">
            Save Draft
          </button>
          <button id="publish-btn" class="chip chip--primary" type="button">
            Publish
          </button>
        </div>
      </header>

      <section class="grid">
        <article class="card">
          <div
            class="card__bar"
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 12px;
            "
          >
            <strong>Editor</strong>
            <div class="segmented" role="group" aria-label="Editor mode">
              <button
                id="mode-md"
                class="chip chip--ghost"
                type="button"
                aria-pressed="true"
              >
                Markdown
              </button>
              <button
                id="mode-rtf"
                class="chip chip--ghost"
                type="button"
                aria-pressed="false"
              >
                Rich Text
              </button>
            </div>
          </div>
          <div class="card__body">
            <div class="row row--single">
              <div class="field">
                <label class="label" for="title">Title</label>
                <input
                  id="title"
                  class="input"
                  type="text"
                  placeholder="Post title"
                  value="{{title}}"
                />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label class="label" for="slug">Slug</label>
                <input
                  id="slug"
                  class="input"
                  type="text"
                  placeholder="e.g., getting-started"
                  value=""
                />
                <div class="help">Used to build the file path and URL.</div>
              </div>
              <div class="field">
                <label class="label">Path</label>
                <div id="pathPreview" class="help">
                  {{#contentDir}}{{contentDir}}/{{/contentDir}}{{filename}}
                </div>
              </div>
            </div>

            <!-- Markdown editor (default) -->
            <div id="md-wrap">
              <div class="field">
                <label class="label" for="md-editor">Markdown</label>
                <div class="editor-toolbar" id="md-toolbar">
                  <button class="editor-btn" data-md="h2" type="button">
                    H2
                  </button>
                  <button class="editor-btn" data-md="h3" type="button">
                    H3
                  </button>
                  <button class="editor-btn" data-md="bold" type="button">
                    <strong>B</strong>
                  </button>
                  <button class="editor-btn" data-md="italic" type="button">
                    <em>I</em>
                  </button>
                  <button class="editor-btn" data-md="ul" type="button">
                    • List
                  </button>
                  <button class="editor-btn" data-md="ol" type="button">
                    1. List
                  </button>
                  <button class="editor-btn" data-md="code" type="button">
                    Code
                  </button>
                  <button class="editor-btn" data-md="quote" type="button">
                    Quote
                  </button>
                  <span class="spacer"></span>
                  <button class="editor-btn" data-md="link" type="button">
                    Link
                  </button>
                </div>
                <textarea
                  id="md-editor"
                  class="textarea"
                  rows="16"
                  placeholder="Write your post in Markdown…"
                >
{{{contentMarkdown}}}</textarea
                >
              </div>
            </div>

            <!-- Rich text editor (secondary) -->
            <div id="rtf-wrap" hidden>
              <div class="field">
                <label class="label">Rich Text Editor</label>
                <div class="editor-toolbar" id="rt-toolbar">
                  <button class="editor-btn" data-cmd="bold" type="button">
                    <strong>B</strong>
                  </button>
                  <button class="editor-btn" data-cmd="italic" type="button">
                    <em>I</em>
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="formatBlock"
                    data-value="H2"
                    type="button"
                  >
                    H2
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="formatBlock"
                    data-value="H3"
                    type="button"
                  >
                    H3
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="insertUnorderedList"
                    type="button"
                  >
                    • List
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="insertOrderedList"
                    type="button"
                  >
                    1. List
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="formatBlock"
                    data-value="BLOCKQUOTE"
                    type="button"
                  >
                    Quote
                  </button>
                  <button
                    class="editor-btn"
                    data-cmd="insertHTML"
                    data-value="<pre><code></code></pre>"
                    type="button"
                  >
                    Code
                  </button>
                  <button class="editor-btn" id="link-btn" type="button">
                    Link
                  </button>
                  <span class="spacer"></span>
                  <button class="editor-btn" data-cmd="undo" type="button">
                    Undo
                  </button>
                  <button class="editor-btn" data-cmd="redo" type="button">
                    Redo
                  </button>
                  <button class="editor-btn" id="clear-btn" type="button">
                    Clear
                  </button>
                </div>
                <div
                  id="editor"
                  class="editor-area"
                  contenteditable="true"
                  spellcheck="true"
                ></div>
              </div>
            </div>
          </div>
        </article>

        <aside class="card">
          <div class="card__bar"><strong>Post Meta</strong></div>
          <div class="card__body">
            <div class="field">
              <label class="label" for="excerpt">Excerpt</label>
              <textarea
                id="excerpt"
                class="textarea"
                placeholder="Short summary…"
              >
{{meta.description}}</textarea
              >
            </div>
            <div class="field">
              <label class="label" for="tags">Tags</label>
              <input
                id="tags"
                class="input"
                type="text"
                placeholder="comma,separated,tags"
                value="{{tagsCsv}}"
              />
              <div class="help">Comma-separated (e.g., demo,intro)</div>
            </div>
            <div class="row">
              <div
                class="col"
                style="gap: 10px; display: flex; flex-direction: column"
              >
                <div class="field">
                  <label class="label" for="pubDate">Publish Date</label>
                  <input
                    id="pubDate"
                    class="input"
                    type="datetime-local"
                    value=""
                    data-iso="{{meta.pubDate}}"
                  />
                </div>
                <div class="field">
                  <label class="label" for="draft">Status</label>
                  <div style="display: flex; align-items: center; gap: 8px">
                    {{#meta.draft}}
                    <input id="draft" type="checkbox" checked />
                    {{/meta.draft}} {{^meta.draft}}
                    <input id="draft" type="checkbox" />
                    {{/meta.draft}}
                    <span class="help">Draft</span>
                  </div>
                </div>
              </div>
            </div>

            <hr
              style="
                border: none;
                border-top: 1px solid var(--color-border-card);
                margin: 14px 0;
              "
            />

            <div class="meta-grid">
              <div class="subtle">Project</div>
              <div id="m-project">{{projectName}}</div>
              <div class="subtle">Repo</div>
              <div id="m-repo">
                <a href="{{repoUrl}}" target="_blank" rel="noopener">link</a>
              </div>
              <div class="subtle">Branch</div>
              <div id="m-branch">{{branch}}</div>
              <div class="subtle">Content Dir</div>
              <div id="m-dir">{{contentDir}}</div>
            </div>

            <div id="danger-zone" class="danger-zone" style="margin-top: 14px">
              <span class="subtle">Danger zone</span>
              <button id="delete-btn" class="chip chip--danger" type="button">
                Delete Post
              </button>
            </div>
          </div>
        </aside>
      </section>
    </main>

    <script src="/js/startup.js" defer></script>
    <script src="/js/pages/blog/editor.js" defer></script>
  </body>
</html>
